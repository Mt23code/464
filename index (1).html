<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Attendance System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [isNFCSupported, setIsNFCSupported] = useState(false);
            const [isScanning, setIsScanning] = useState(false);
            const [attendanceRecords, setAttendanceRecords] = useState([]);
            const [message, setMessage] = useState('');
            const [messageType, setMessageType] = useState('info');
            const [activeTab, setActiveTab] = useState('scan');
            const [firebaseConfigured, setFirebaseConfigured] = useState(false);
            const [showFirebaseSetup, setShowFirebaseSetup] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            
            // Firebase config state
            const [firebaseConfig, setFirebaseConfig] = useState({
                apiKey: '',
                authDomain: '',
                projectId: '',
                storageBucket: '',
                messagingSenderId: '',
                appId: ''
            });

            const dbRef = useRef(null);
            const ndefReaderRef = useRef(null);

            useEffect(() => {
                // Check NFC support
                if ('NDEFReader' in window) {
                    setIsNFCSupported(true);
                } else {
                    showMessage('NFC is not supported. Please use Chrome on Android.', 'error');
                }

                // Check for saved Firebase config
                const savedConfig = localStorage.getItem('firebaseConfig');
                if (savedConfig) {
                    try {
                        const config = JSON.parse(savedConfig);
                        setFirebaseConfig(config);
                        initializeFirebase(config);
                    } catch (error) {
                        console.error('Error loading Firebase config:', error);
                        setIsLoading(false);
                    }
                } else {
                    setIsLoading(false);
                    setShowFirebaseSetup(true);
                }
            }, []);

            const initializeFirebase = async (config) => {
                try {
                    // Initialize Firebase
                    if (!firebase.apps.length) {
                        firebase.initializeApp(config);
                    }
                    
                    // Sign in anonymously
                    await firebase.auth().signInAnonymously();
                    
                    dbRef.current = firebase.firestore();
                    setFirebaseConfigured(true);
                    showMessage('‚úÖ Connected to Firebase!', 'success');
                    
                    // Load attendance records
                    loadAttendanceFromFirebase();
                    
                } catch (error) {
                    console.error('Firebase initialization error:', error);
                    showMessage(`Firebase error: ${error.message}`, 'error');
                    setFirebaseConfigured(false);
                } finally {
                    setIsLoading(false);
                }
            };

            const saveFirebaseConfig = () => {
                // Validate config
                if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
                    showMessage('Please fill in at least API Key and Project ID', 'error');
                    return;
                }

                localStorage.setItem('firebaseConfig', JSON.stringify(firebaseConfig));
                initializeFirebase(firebaseConfig);
                setShowFirebaseSetup(false);
            };

            const loadAttendanceFromFirebase = async () => {
                if (!dbRef.current) return;

                try {
                    setIsLoading(true);
                    const snapshot = await dbRef.current.collection('attendance')
                        .orderBy('timestamp', 'desc')
                        .limit(500)
                        .get();
                    
                    const records = [];
                    snapshot.forEach(doc => {
                        records.push({ id: doc.id, ...doc.data() });
                    });
                    
                    setAttendanceRecords(records);
                    showMessage(`Loaded ${records.length} records from cloud`, 'success');
                } catch (error) {
                    console.error('Error loading records:', error);
                    showMessage('Error loading records from cloud', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            const saveAttendanceToFirebase = async (record) => {
                if (!dbRef.current) {
                    showMessage('Firebase not connected', 'error');
                    return;
                }

                try {
                    const docRef = await dbRef.current.collection('attendance').add(record);
                    return docRef.id;
                } catch (error) {
                    console.error('Error saving to Firebase:', error);
                    showMessage('Error saving to cloud', 'error');
                    return null;
                }
            };

            const deleteRecordFromFirebase = async (recordId) => {
                if (!dbRef.current) return;

                try {
                    await dbRef.current.collection('attendance').doc(recordId).delete();
                } catch (error) {
                    console.error('Error deleting from Firebase:', error);
                    showMessage('Error deleting from cloud', 'error');
                }
            };

            const showMessage = (msg, type = 'info') => {
                setMessage(msg);
                setMessageType(type);
                setTimeout(() => setMessage(''), 5000);
            };

            const startScanning = async () => {
                if (!isNFCSupported) {
                    showMessage('NFC is not supported on this device.', 'error');
                    return;
                }

                if (!firebaseConfigured) {
                    showMessage('Please configure Firebase first', 'error');
                    return;
                }

                try {
                    const reader = new NDEFReader();
                    await reader.scan();
                    ndefReaderRef.current = reader;
                    setIsScanning(true);
                    showMessage('üì± Ready to scan! Hold an NFC tag near your device...', 'info');

                    reader.addEventListener('reading', ({ message, serialNumber }) => {
                        handleNFCRead(message, serialNumber);
                    });

                    reader.addEventListener('readingerror', () => {
                        showMessage('Error reading NFC tag. Please try again.', 'error');
                    });

                } catch (error) {
                    showMessage(`Error starting scan: ${error.message}`, 'error');
                    setIsScanning(false);
                }
            };

            const stopScanning = () => {
                setIsScanning(false);
                ndefReaderRef.current = null;
                showMessage('Scanning stopped.', 'info');
            };

            const handleNFCRead = (message, serialNumber) => {
                let userId = null;
                let userName = null;

                for (const record of message.records) {
                    if (record.recordType === "text") {
                        const textDecoder = new TextDecoder(record.encoding);
                        const text = textDecoder.decode(record.data);
                        
                        try {
                            const data = JSON.parse(text);
                            userId = data.userId;
                            userName = data.userName;
                        } catch (e) {
                            userId = text;
                        }
                    }
                }

                if (!userId) {
                    userId = serialNumber;
                    userName = `User ${serialNumber.slice(0, 8)}`;
                }

                recordAttendance(userId, userName);
            };

            const recordAttendance = async (userId, userName) => {
                const now = new Date();
                const timestamp = now.toISOString();
                const date = now.toLocaleDateString('en-US');
                const time = now.toLocaleTimeString('en-US');

                // Check if already marked present today
                const existingRecord = attendanceRecords.find(
                    record => record.userId === userId && record.date === date
                );

                if (existingRecord) {
                    showMessage(`‚ö†Ô∏è ${userName || userId} already marked present today at ${existingRecord.time}`, 'warning');
                    playSound(false);
                    return;
                }

                // Create new record
                const newRecord = {
                    userId,
                    userName: userName || `User ${userId.slice(0, 8)}`,
                    timestamp,
                    date,
                    time,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Save to Firebase
                const docId = await saveAttendanceToFirebase(newRecord);
                
                if (docId) {
                    newRecord.id = docId;
                    setAttendanceRecords(prev => [newRecord, ...prev]);
                    showMessage(`‚úÖ ${newRecord.userName} marked present!`, 'success');
                    playSound(true);
                }
            };

            const playSound = (success) => {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = success ? 800 : 400;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } catch (error) {
                    // Silent fail
                }
            };

            const getTodayAttendance = () => {
                const today = new Date().toLocaleDateString('en-US');
                return attendanceRecords.filter(record => record.date === today);
            };

            const deleteRecord = async (recordId) => {
                if (window.confirm('Delete this attendance record?')) {
                    await deleteRecordFromFirebase(recordId);
                    setAttendanceRecords(prev => prev.filter(record => record.id !== recordId));
                    showMessage('Record deleted.', 'info');
                }
            };

            const clearAllRecords = async () => {
                if (!window.confirm('‚ö†Ô∏è Are you sure you want to delete ALL attendance records? This cannot be undone.')) {
                    return;
                }

                if (!dbRef.current) return;

                try {
                    setIsLoading(true);
                    const batch = dbRef.current.batch();
                    const snapshot = await dbRef.current.collection('attendance').get();
                    
                    snapshot.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    await batch.commit();
                    setAttendanceRecords([]);
                    showMessage('All records cleared.', 'info');
                } catch (error) {
                    console.error('Error clearing records:', error);
                    showMessage('Error clearing records', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            const exportToCSV = () => {
                if (attendanceRecords.length === 0) {
                    showMessage('No records to export.', 'warning');
                    return;
                }

                const csvContent = [
                    ['Name', 'User ID', 'Date', 'Time'],
                    ...attendanceRecords.map(record => [
                        record.userName,
                        record.userId,
                        record.date,
                        record.time
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `attendance_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);

                showMessage('‚úÖ Attendance exported successfully!', 'success');
            };

            const getUniqueUsers = () => {
                const userMap = new Map();
                attendanceRecords.forEach(record => {
                    if (!userMap.has(record.userId)) {
                        userMap.set(record.userId, {
                            userId: record.userId,
                            userName: record.userName,
                            attendanceCount: 0
                        });
                    }
                    userMap.get(record.userId).attendanceCount++;
                });
                return Array.from(userMap.values());
            };

            const stats = {
                totalRecords: attendanceRecords.length,
                uniqueUsers: getUniqueUsers().length,
                todayCount: getTodayAttendance().length,
                totalDays: new Set(attendanceRecords.map(r => r.date)).size
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-4"></div>
                            <p className="text-gray-600 font-medium">Loading...</p>
                        </div>
                    </div>
                );
            }

            if (showFirebaseSetup) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 flex items-center justify-center">
                        <div className="max-w-2xl w-full bg-white rounded-2xl shadow-xl p-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Firebase Setup</h1>
                            <p className="text-gray-600 mb-6">Configure your Firebase project to enable cloud storage</p>
                            
                            <div className="space-y-4 mb-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">API Key *</label>
                                    <input
                                        type="text"
                                        value={firebaseConfig.apiKey}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, apiKey: e.target.value})}
                                        placeholder="AIzaSy..."
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Auth Domain</label>
                                    <input
                                        type="text"
                                        value={firebaseConfig.authDomain}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, authDomain: e.target.value})}
                                        placeholder="your-app.firebaseapp.com"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Project ID *</label>
                                    <input
                                        type="text"
                                        value={firebaseConfig.projectId}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, projectId: e.target.value})}
                                        placeholder="your-project-id"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Storage Bucket</label>
                                    <input
                                        type="text"
                                        value={firebaseConfig.storageBucket}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, storageBucket: e.target.value})}
                                        placeholder="your-app.appspot.com"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Messaging Sender ID</label>
                                    <input
                                        type="text"
                                        value={firebaseConfig.messagingSenderId}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, messagingSenderId: e.target.value})}
                                        placeholder="123456789"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">App ID</label>
                                    <input
                                        type="text"
                                        value={firebaseConfig.appId}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, appId: e.target.value})}
                                        placeholder="1:123456789:web:abc123"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                            </div>

                            <div className="bg-blue-50 p-4 rounded-lg mb-6">
                                <p className="text-sm text-blue-800 font-medium mb-2">üìò How to get Firebase config:</p>
                                <ol className="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                                    <li>Go to <a href="https://console.firebase.google.com" target="_blank" className="underline">Firebase Console</a></li>
                                    <li>Create a new project or select existing</li>
                                    <li>Go to Project Settings ‚öôÔ∏è</li>
                                    <li>Scroll down to "Your apps" section</li>
                                    <li>Click "Web app" and copy the config values</li>
                                    <li>Enable Firestore Database in Build menu</li>
                                    <li>Set Firestore rules to allow read/write (for testing)</li>
                                </ol>
                            </div>

                            <button
                                onClick={saveFirebaseConfig}
                                className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition"
                            >
                                Connect to Firebase
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6 border border-indigo-100">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="bg-indigo-600 p-3 rounded-xl">
                                        <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">NFC Attendance</h1>
                                        <p className="text-gray-600">Cloud-synced attendance tracking</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <div className="flex items-center gap-2 mb-1">
                                        <div className={`w-2 h-2 rounded-full ${firebaseConfigured ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                        <p className="text-xs text-gray-500">{firebaseConfigured ? 'Connected' : 'Offline'}</p>
                                    </div>
                                    <p className="text-2xl font-bold text-indigo-600">{stats.todayCount}</p>
                                    <p className="text-xs text-gray-500">present today</p>
                                </div>
                            </div>
                        </div>

                        {/* Status Message */}
                        {message && (
                            <div className={`p-4 rounded-xl mb-6 shadow-lg ${
                                messageType === 'error' ? 'bg-red-100 text-red-700 border border-red-300' :
                                messageType === 'success' ? 'bg-green-100 text-green-700 border border-green-300' :
                                messageType === 'warning' ? 'bg-yellow-100 text-yellow-700 border border-yellow-300' :
                                'bg-blue-100 text-blue-700 border border-blue-300'
                            }`}>
                                <p className="font-medium">{message}</p>
                            </div>
                        )}

                        {/* Stats Cards */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                                <div className="flex items-center gap-2 mb-2">
                                    <svg className="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                    <span className="text-sm text-gray-600">Users</span>
                                </div>
                                <p className="text-2xl font-bold text-gray-800">{stats.uniqueUsers}</p>
                            </div>
                            <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                                <div className="flex items-center gap-2 mb-2">
                                    <svg className="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span className="text-sm text-gray-600">Records</span>
                                </div>
                                <p className="text-2xl font-bold text-gray-800">{stats.totalRecords}</p>
                            </div>
                            <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                                <div className="flex items-center gap-2 mb-2">
                                    <svg className="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    <span className="text-sm text-gray-600">Days</span>
                                </div>
                                <p className="text-2xl font-bold text-gray-800">{stats.totalDays}</p>
                            </div>
                            <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                                <div className="flex items-center gap-2 mb-2">
                                    <svg className="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span className="text-sm text-gray-600">Today</span>
                                </div>
                                <p className="text-2xl font-bold text-gray-800">{stats.todayCount}</p>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 mb-6 overflow-x-auto">
                            <button
                                onClick={() => setActiveTab('scan')}
                                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition whitespace-nowrap ${
                                    activeTab === 'scan' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-gray-50 shadow'
                                }`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                                </svg>
                                Scan
                            </button>
                            <button
                                onClick={() => setActiveTab('records')}
                                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition whitespace-nowrap ${
                                    activeTab === 'records' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-gray-50 shadow'
                                }`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                                Records
                            </button>
                            <button
                                onClick={() => setActiveTab('users')}
                                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition whitespace-nowrap ${
                                    activeTab === 'users' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-gray-50 shadow'
                                }`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                Users
                            </button>
                            <button
                                onClick={() => setShowFirebaseSetup(true)}
                                className="flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition whitespace-nowrap bg-white text-gray-700 hover:bg-gray-50 shadow"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                Settings
                            </button>
                        </div>

                        {/* Scan Tab */}
                        {activeTab === 'scan' && (
                            <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                                <h2 className="text-2xl font-bold mb-6 text-gray-800">Scan NFC Tags</h2>
                                
                                <div className="text-center mb-6">
                                    {!isScanning ? (
                                        <button
                                            onClick={startScanning}
                                            disabled={!isNFCSupported || !firebaseConfigured}
                                            className="w-full md:w-auto bg-indigo-600 text-white px-8 py-4 rounded-xl font-semibold hover:bg-indigo-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-3 mx-auto shadow-lg hover:shadow-xl transform hover:scale-105"
                                        >
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                                            </svg>
                                            Start Scanning
                                        </button>
                                    ) : (
                                        <div className="space-y-4">
                                            <div className="bg-indigo-50 p-8 rounded-xl border-2 border-indigo-200 animate-pulse">
                                                <svg className="w-16 h-16 text-indigo-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                                                </svg>
                                                <p className="text-lg font-semibold text-indigo-700">Scanning Active</p>
                                                <p className="text-sm text-indigo-600 mt-2">Hold NFC tag near device</p>
                                            </div>
                                            <button
                                                onClick={stopScanning}
                                                className="w-full md:w-auto bg-red-600 text-white px-8 py-4 rounded-xl font-semibold hover:bg-red-700 transition flex items-center justify-center gap-3 mx-auto shadow-lg"
                                            >
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                                Stop Scanning
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Today's Attendance */}
                                <div className="mt-8">
                                    <h3 className="text-xl font-semibold mb-4 text-gray-800">Today's Attendance</h3>
                                    
                                    {getTodayAttendance().length === 0 ? (
                                        <div className="text-center py-12 bg-gray-50 rounded-xl">
                                            <svg className="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                            </svg>
                                            <p className="text-gray-500">No attendance recorded today</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-2 max-h-96 overflow-y-auto">
                                            {getTodayAttendance().map((record, index) => (
                                                <div key={record.id} className="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-xl border border-green-200 hover:shadow-md transition">
                                                    <div className="flex items-center gap-3">
                                                        <div className="bg-green-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm">
                                                            {index + 1}
                                                        </div>
                                                        <div>
                                                            <p className="font-semibold text-gray-800">{record.userName}</p>
                                                            <p className="text-sm text-gray-600">{record.userId}</p>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="text-sm font-medium text-gray-700">{record.time}</p>
                                                        <svg className="w-5 h-5 text-green-600 ml-auto mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Records Tab */}
                        {activeTab === 'records' && (
                            <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Attendance Records</h2>
                                    <div className="flex gap-2 flex-wrap">
                                        <button
                                            onClick={loadAttendanceFromFirebase}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center gap-2 shadow"
                                        >
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                            Refresh
                                        </button>
                                        <button
                                            onClick={exportToCSV}
                                            disabled={attendanceRecords.length === 0}
                                            className="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 shadow"
                                        >
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                            </svg>
                                            Export CSV
                                        </button>
                                        <button
                                            onClick={clearAllRecords}
                                            disabled={attendanceRecords.length === 0}
                                            className="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 shadow"
                                        >
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                            Clear All
                                        </button>
                                    </div>
                                </div>

                                {attendanceRecords.length === 0 ? (
                                    <div className="text-center py-16 bg-gray-50 rounded-xl">
                                        <svg className="w-20 h-20 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                        </svg>
                                        <p className="text-gray-500 text-lg">No attendance records yet</p>
                                        <p className="text-gray-400 text-sm mt-2">Start scanning NFC tags to record attendance</p>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-gradient-to-r from-indigo-50 to-purple-50">
                                                <tr>
                                                    <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">#</th>
                                                    <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Name</th>
                                                    <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">User ID</th>
                                                    <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date</th>
                                                    <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Time</th>
                                                    <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                {attendanceRecords.map((record, index) => (
                                                    <tr key={record.id} className="hover:bg-gray-50 transition">
                                                        <td className="px-4 py-3 text-sm text-gray-600">{index + 1}</td>
                                                        <td className="px-4 py-3 text-sm font-medium text-gray-800">{record.userName}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{record.userId}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{record.date}</td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">{record.time}</td>
                                                        <td className="px-4 py-3">
                                                            <button
                                                                onClick={() => deleteRecord(record.id)}
                                                                className="text-red-600 hover:text-red-700 p-1 hover:bg-red-50 rounded transition"
                                                            >
                                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                </svg>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Users Tab */}
                        {activeTab === 'users' && (
                            <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                                <h2 className="text-2xl font-bold mb-6 text-gray-800">Registered Users</h2>
                                
                                {getUniqueUsers().length === 0 ? (
                                    <div className="text-center py-16 bg-gray-50 rounded-xl">
                                        <svg className="w-20 h-20 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                        <p className="text-gray-500 text-lg">No users found</p>
                                        <p className="text-gray-400 text-sm mt-2">Users will appear here once they scan their NFC tags</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {getUniqueUsers().map((user) => (
                                            <div key={user.userId} className="p-4 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl border border-indigo-200 hover:shadow-lg transition">
                                                <div className="flex items-start justify-between mb-2">
                                                    <div className="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold">
                                                        {user.userName.charAt(0).toUpperCase()}
                                                    </div>
                                                    <div className="bg-white px-3 py-1 rounded-full text-xs font-semibold text-indigo-600">
                                                        {user.attendanceCount} days
                                                    </div>
                                                </div>
                                                <h3 className="font-semibold text-gray-800 mb-1">{user.userName}</h3>
                                                <p className="text-sm text-gray-600">{user.userId}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Footer */}
                        <div className="mt-8 text-center text-sm text-gray-500">
                            <p>NFC Attendance System with Firebase ‚Ä¢ Cloud Synced</p>
                            <p className="mt-1">Works on Chrome for Android only</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
